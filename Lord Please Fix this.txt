
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74
		`;await r.execute(v`CREATE SCHEMA IF NOT EXISTS ${v.identifier(s)}`),await r.execute(a);let u=(await r.all(v`select id, hash, created_at from ${v.identifier(s)}.${v.identifier(i)} order by created_at desc limit 1`))[0];await r.transaction(async l=>{for await(let c of e)if(!u||Number(u.created_at)<c.folderMillis){for(let p of c.sql)await l.execute(v.raw(p));await l.execute(v`insert into ${v.identifier(s)}.${v.identifier(i)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(e){return`"${e}"`}escapeParam(e){return`$${e+1}`}escapeString(e){return`'${e.replace(/'/g,"''")}'`}buildWithCTE(e){if(!e?.length)return;let r=[v`with `];for(let[n,i]of e.entries())r.push(v`${v.identifier(i._.alias)} as (${i._.sql})`),n<e.length-1&&r.push(v`, `);return r.push(v` `),v.join(r)}buildDeleteQuery({table:e,where:r,returning:n,withList:i}){let s=this.buildWithCTE(i),a=n?v` returning ${this.buildSelection(n,{isSingleTable:!0})}`:void 0,o=r?v` where ${r}`:void 0;return v`${s}delete from ${e}${o}${a}`}buildUpdateSet(e,r){let n=e[j.Symbol.Columns],i=Object.keys(n).filter(a=>r[a]!==void 0||n[a]?.onUpdateFn!==void 0),s=i.length;return v.join(i.flatMap((a,o)=>{let u=n[a],l=r[a]??v.param(u.onUpdateFn(),u),c=v`${v.identifier(this.casing.getColumnCasing(u))} = ${l}`;return o<s-1?[c,v.raw(", ")]:[c]}))}buildUpdateQuery({table:e,set:r,where:n,returning:i,withList:s,from:a,joins:o}){let u=this.buildWithCTE(s),l=e[Ze.Symbol.Name],c=e[Ze.Symbol.Schema],p=e[Ze.Symbol.OriginalName],d=l===p?void 0:l,f=v`${c?v`${v.identifier(c)}.`:void 0}${v.identifier(p)}${d&&v` ${v.identifier(d)}`}`,m=this.buildUpdateSet(e,r),g=a&&v.join([v.raw(" from "),this.buildFromTable(a)]),y=this.buildJoins(o),x=i?v` returning ${this.buildSelection(i,{isSingleTable:!a})}`:void 0,T=n?v` where ${n}`:void 0;return v`${u}update ${f} set ${m}${g}${y}${T}${x}`}buildSelection(e,{isSingleTable:r=!1}={}){let n=e.length,i=e.flatMap(({field:s},a)=>{let o=[];if(A(s,U.Aliased)&&s.isSelectionField)o.push(v.identifier(s.fieldAlias));else if(A(s,U.Aliased)||A(s,U)){let u=A(s,U.Aliased)?s.sql:s;r?o.push(new U(u.queryChunks.map(l=>A(l,M)?v.identifier(this.casing.getColumnCasing(l)):l))):o.push(u),A(s,U.Aliased)&&o.push(v` as ${v.identifier(s.fieldAlias)}`)}else A(s,pe)&&(r?o.push(v.identifier(this.casing.getColumnCasing(s))):o.push(s));return a<n-1&&o.push(v`, `),o});return v.join(i)}buildJoins(e){if(!e||e.length===0)return;let r=[];for(let[n,i]of e.entries()){n===0&&r.push(v` `);let s=i.table,a=i.lateral?v` lateral`:void 0;if(A(s,Ze)){let o=s[Ze.Symbol.Name],u=s[Ze.Symbol.Schema],l=s[Ze.Symbol.OriginalName],c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else if(A(s,ft)){let o=s[ve].name,u=s[ve].schema,l=s[ve].originalName,c=o===l?void 0:i.alias;r.push(v`${v.raw(i.joinType)} join${a} ${u?v`${v.identifier(u)}.`:void 0}${v.identifier(l)}${c&&v` ${v.identifier(c)}`} on ${i.on}`)}else r.push(v`${v.raw(i.joinType)} join${a} ${s} on ${i.on}`);n<e.length-1&&r.push(v` `)}return v.join(r)}buildFromTable(e){if(A(e,j)&&e[j.Symbol.OriginalName]!==e[j.Symbol.Name]){let r=v`${v.identifier(e[j.Symbol.OriginalName])}`;return e[j.Symbol.Schema]&&(r=v`${v.identifier(e[j.Symbol.Schema])}.${r}`),v`${r} ${v.identifier(e[j.Symbol.Name])}`}return e}buildSelectQuery({withList:e,fields:r,fieldsFlat:n,where:i,having:s,table:a,joins:o,orderBy:u,groupBy:l,limit:c,offset:p,lockingClause:d,distinct:f,setOperators:m}){let g=n??Ht(r);for(let fe of g)if(A(fe.field,pe)&&Tt(fe.field.table)!==(A(a,qe)?a._.alias:A(a,Ri)?a[ve].name:A(a,U)?void 0:Tt(a))&&!(Ce=>o?.some(({alias:ar})=>ar===(Ce[j.Symbol.IsAlias]?Tt(Ce):Ce[j.Symbol.BaseName])))(fe.field.table)){let Ce=Tt(fe.field.table);throw new Error(`Your "${fe.path.join("->")}" field references a column "${Ce}"."${fe.field.name}", but the table "${Ce}" is not part of the query! Did you forget to join it?`)}let y=!o||o.length===0,x=this.buildWithCTE(e),T;f&&(T=f===!0?v` distinct`:v` distinct on (${v.join(f.on,v`, `)})`);let S=this.buildSelection(g,{isSingleTable:y}),E=this.buildFromTable(a),k=this.buildJoins(o),F=i?v` where ${i}`:void 0,D=s?v` having ${s}`:void 0,I;u&&u.length>0&&(I=v` order by ${v.join(u,v`, `)}`);let Q;l&&l.length>0&&(Q=v` group by ${v.join(l,v`, `)}`);let ne=typeof c=="object"||typeof c=="number"&&c>=0?v` limit ${c}`:void 0,me=p?v` offset ${p}`:void 0,Me=v.empty();if(d){let fe=v` for ${v.raw(d.strength)}`;d.config.of&&fe.append(v` of ${v.join(Array.isArray(d.config.of)?d.config.of:[d.config.of],v`, `)}`),d.config.noWait?fe.append(v` no wait`):d.config.skipLocked&&fe.append(v` skip locked`),Me.append(fe)}let se=v`${x}select${T} ${S} from ${E}${k}${F}${Q}${D}${I}${ne}${me}${Me}`;return m.length>0?this.buildSetOperations(se,m):se}buildSetOperations(e,r){let[n,...i]=r;if(!n)throw new Error("Cannot pass undefined values to any set operator");return i.length===0?this.buildSetOperationQuery({leftSelect:e,setOperator:n}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:e,setOperator:n}),i)}buildSetOperationQuery({leftSelect:e,setOperator:{type:r,isAll:n,rightSelect:i,limit:s,orderBy:a,offset:o}}){let u=v`(${e.getSQL()}) `,l=v`(${i.getSQL()})`,c;if(a&&a.length>0){let m=[];for(let g of a)if(A(g,M))m.push(v.identifier(g.name));else if(A(g,U)){for(let y=0;y<g.queryChunks.length;y++){let x=g.queryChunks[y];A(x,M)&&(g.queryChunks[y]=v.identifier(x.name))}m.push(v`${g}`)}else m.push(v`${g}`);c=v` order by ${v.join(m,v`, `)} `}let p=typeof s=="object"||typeof s=="number"&&s>=0?v` limit ${s}`:void 0,d=v.raw(`${r} ${n?"all ":""}`),f=o?v` offset ${o}`:void 0;return v`${u}${d}${l}${c}${p}${f}`}buildInsertQuery({table:e,values:r,onConflict:n,returning:i,withList:s,select:a,overridingSystemValue_:o}){let u=[],l=e[j.Symbol.Columns],c=Object.entries(l).filter(([x,T])=>!T.shouldDisableInsert()),p=c.map(([,x])=>v.identifier(this.casing.getColumnCasing(x)));if(a){let x=r;A(x,U)?u.push(x):u.push(x.getSQL())}else{let x=r;u.push(v.raw("values "));for(let[T,S]of x.entries()){let E=[];for(let[k,F]of c){let D=S[k];if(D===void 0||A(D,St)&&D.value===void 0)if(F.defaultFn!==void 0){let I=F.defaultFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else if(!F.default&&F.onUpdateFn!==void 0){let I=F.onUpdateFn(),Q=A(I,U)?I:v.param(I,F);E.push(Q)}else E.push(v`default`);else E.push(D)}u.push(E),T<x.length-1&&u.push(v`, `)}}let d=this.buildWithCTE(s),f=v.join(u),m=i?v` returning ${this.buildSelection(i,{isSingleTable:!0})}`:void 0,g=n?v` on conflict ${n}`:void 0,y=o===!0?v`overriding system value `:void 0;return v`${d}insert into ${e} ${p} ${y}${f}${g}${m}`}buildRefreshMaterializedViewQuery({view:e,concurrently:r,withNoData:n}){let i=r?v` concurrently`:void 0,s=n?v` with no data`:void 0;return v`refresh materialized view${i} ${e}${s}`}prepareTyping(e){return A(e,sa)||A(e,ia)?"json":A(e,aa)?"decimal":A(e,ca)?"time":A(e,la)||A(e,ua)?"timestamp":A(e,ra)||A(e,na)?"date":A(e,pa)?"uuid":"none"}sqlToQuery(e,r){return e.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:r})}buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:i,tableConfig:s,queryConfig:a,tableAlias:o,nestedQueryRelation:u,joinOn:l}){let c=[],p,d,f=[],m,g=[];if(a===!0)c=Object.entries(s.columns).map(([T,S])=>({dbKey:S.name,tsKey:T,field:dr(S,o),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let x=Object.fromEntries(Object.entries(s.columns).map(([D,I])=>[D,dr(I,o)]));if(a.where){let D=typeof a.where=="function"?a.where(x,r_()):a.where;m=D&&ea(D,o)}let T=[],S=[];if(a.columns){let D=!1;for(let[I,Q]of Object.entries(a.columns))Q!==void 0&&I in s.columns&&(!D&&Q===!0&&(D=!0),S.push(I));S.length>0&&(S=D?S.filter(I=>a.columns?.[I]===!0):Object.keys(s.columns).filter(I=>!S.includes(I)))}else S=Object.keys(s.columns);for(let D of S){let I=s.columns[D];T.push({tsKey:D,value:I})}let E=[];a.with&&(E=Object.entries(a.with).filter(D=>!!D[1]).map(([D,I])=>({tsKey:D,queryConfig:I,relation:s.relations[D]})));let k;if(a.extras){k=typeof a.extras=="function"?a.extras(x,{sql:v}):a.extras;for(let[D,I]of Object.entries(k))T.push({tsKey:D,value:Ff(I,o)})}for(let{tsKey:D,value:I}of T)c.push({dbKey:A(I,U.Aliased)?I.fieldAlias:s.columns[D].name,tsKey:D,field:A(I,pe)?dr(I,o):I,relationTableTsKey:void 0,isJson:!1,selection:[]});let F=typeof a.orderBy=="function"?a.orderBy(x,n_()):a.orderBy??[];Array.isArray(F)||(F=[F]),f=F.map(D=>A(D,pe)?dr(D,o):ea(D,o)),p=a.limit,d=a.offset;for(let{tsKey:D,queryConfig:I,relation:Q}of E){let ne=s_(r,n,Q),me=Rn(Q.referencedTable),Me=n[me],se=`${o}_${D}`,fe=Ue(...ne.fields.map((Lt,Sr)=>Y(dr(ne.references[Sr],se),dr(Lt,o)))),Ce=this.buildRelationalQueryWithoutPK({fullSchema:e,schema:r,tableNamesMap:n,table:e[Me],tableConfig:r[Me],queryConfig:A(Q,Zr)?I===!0?{limit:1}:{...I,limit:1}:I,tableAlias:se,joinOn:fe,nestedQueryRelation:Q}),ar=v`${v.identifier(se)}.${v.identifier("data")}`.as(D);g.push({on:v`true`,table:new qe(Ce.sql,{},se),alias:se,joinType:"left",lateral:!0}),c.push({dbKey:D,tsKey:D,field:ar,relationTableTsKey:Me,isJson:!0,selection:Ce.selection})}}if(c.length===0)throw new fa({message:`No fields selected for table "${s.tsName}" ("${o}")`});let y;if(m=Ue(l,m),u){let x=v`json_build_array(${v.join(c.map(({field:E,tsKey:k,isJson:F})=>F?v`${v.identifier(`${o}_${k}`)}.${v.identifier("data")}`:A(E,U.Aliased)?E.sql:E),v`, `)})`;A(u,ha)&&(x=v`coalesce(json_agg(${x}${f.length>0?v` order by ${v.join(f,v`, `)}`:void 0}), '[]'::json)`);let T=[{dbKey:"data",tsKey:"data",field:x.as("data"),isJson:!0,relationTableTsKey:s.tsName,selection:c}];p!==void 0||d!==void 0||f.length>0?(y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:[{path:[],field:v.raw("*")}],where:m,limit:p,offset:d,orderBy:f,setOperators:[]}),m=void 0,p=void 0,d=void 0,f=[]):y=Js(i,o),y=this.buildSelectQuery({table:A(y,Ze)?y:new qe(y,{},o),fields:{},fieldsFlat:T.map(({field:E})=>({path:[],field:A(E,pe)?dr(E,o):E})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]})}else y=this.buildSelectQuery({table:Js(i,o),fields:{},fieldsFlat:c.map(({field:x})=>({path:[],field:A(x,pe)?dr(x,o):x})),joins:g,where:m,limit:p,offset:d,orderBy:f,setOperators:[]});return{tableTsKey:s.tsName,sql:y,selection:c}}};var al=class{static[b]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}};var ct=class{static[b]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(e){this.fields=e.fields,this.session=e.session,this.dialect=e.dialect,e.withList&&(this.withList=e.withList),this.distinct=e.distinct}authToken;setToken(e){return this.authToken=e,this}from(e){let r=!!this.fields,n=e,i;return this.fields?i=this.fields:A(n,qe)?i=Object.fromEntries(Object.keys(n._.selectedFields).map(s=>[s,n[s]])):A(n,Ri)?i=n[ve].selectedFields:A(n,U)?i={}:i=Zc(n),new ol({table:n,fields:i,isPartialSelect:r,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}},eh=class extends al{static[b]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;constructor({table:e,fields:r,isPartialSelect:n,session:i,dialect:s,withList:a,distinct:o}){super(),this.config={withList:a,table:e,fields:{...r},distinct:o,setOperators:[]},this.isPartialSelect=n,this.session=i,this.dialect=s,this._={selectedFields:r},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}createJoin(e){return(r,n)=>{let i=this.tableName,s=Nr(r);if(typeof s=="string"&&this.config.joins?.some(a=>a.alias===s))throw new Error(`Alias "${s}" is already used in this query`);if(!this.isPartialSelect&&(Object.keys(this.joinsNotNullableMap).length===1&&typeof i=="string"&&(this.config.fields={[i]:this.config.fields}),typeof s=="string"&&!A(r,U))){let a=A(r,qe)?r._.selectedFields:A(r,ft)?r[ve].selectedFields:r[j.Symbol.Columns];this.config.fields[s]=a}if(typeof n=="function"&&(n=n(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:n,table:r,joinType:e,alias:s}),typeof s=="string")switch(e){case"left":{this.joinsNotNullableMap[s]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!0;break}case"inner":{this.joinsNotNullableMap[s]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[s]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");createSetOperator(e,r){return n=>{let i=typeof n=="function"?n(iF()):n;if(!ta(this.getSelectedFields(),i.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:e,isAll:r,rightSelect:i}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(e){return this.config.setOperators.push(...e),this}where(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=e,this}having(e){return typeof e=="function"&&(e=e(new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=e,this}groupBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(r)?r:[r]}else this.config.groupBy=e;return this}orderBy(...e){if(typeof e[0]=="function"){let r=e[0](new Proxy(this.config.fields,new Ae({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),n=Array.isArray(r)?r:[r];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=n:this.config.orderBy=n}else{let r=e;this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=r:this.config.orderBy=r}return this}limit(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=e:this.config.limit=e,this}offset(e){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=e:this.config.offset=e,this}for(e,r={}){return this.config.lockingClause={strength:e,config:r},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}as(e){return new Proxy(new qe(this.getSQL(),this.config.fields,e),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new Ae({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}},ol=class extends eh{static[b]="PgSelect";_prepare(e){let{session:r,config:n,dialect:i,joinsNotNullableMap:s,authToken:a}=this;if(!r)throw new Error("Cannot execute a query on a query builder. Please use a database instance instead.");return ye.startActiveSpan("drizzle.prepareQuery",()=>{let o=Ht(n.fields),u=r.prepareQuery(i.sqlToQuery(this.getSQL()),o,e,!0);return u.joinsNotNullableMap=s,u.setToken(a)})}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};lS(ol,[ot]);function Di(t,e){return(r,n,...i)=>{let s=[n,...i].map(a=>({type:t,isAll:e,rightSelect:a}));for(let a of s)if(!ta(r.getSelectedFields(),a.rightSelect.getSelectedFields()))throw new Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return r.addSetOperators(s)}}var iF=()=>({union:sF,unionAll:aF,intersect:oF,intersectAll:cF,except:lF,exceptAll:uF}),sF=Di("union",!1),aF=Di("union",!0),oF=Di("intersect",!1),cF=Di("intersect",!0),lF=Di("except",!1),uF=Di("except",!0);var Fi=class{static[b]="PgQueryBuilder";dialect;dialectConfig;constructor(e){this.dialect=A(e,Xr)?e:void 0,this.dialectConfig=A(e,Xr)?void 0:e}$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(n)),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...e){let r=this;function n(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),withList:e})}function i(a){return new ct({fields:a??void 0,session:void 0,dialect:r.getDialect(),distinct:!0})}function s(a,o){return new ct({fields:o??void 0,session:void 0,dialect:r.getDialect(),distinct:{on:a}})}return{select:n,selectDistinct:i,selectDistinctOn:s}}select(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(e){return new ct({fields:e??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:e}})}getDialect(){return this.dialect||(this.dialect=new Xr(this.dialectConfig)),this.dialect}};var ga=class{constructor(e,r,n,i,s){this.table=e,this.session=r,this.dialect=n,this.withList=i,this.overridingSystemValue_=s}static[b]="PgInsertBuilder";authToken;setToken(e){return this.authToken=e,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(e){if(e=Array.isArray(e)?e:[e],e.length===0)throw new Error("values() must be called with at least one value");let r=e.map(n=>{let i={},s=this.table[j.Symbol.Columns];for(let a of Object.keys(n)){let o=n[a];i[a]=A(o,U)?o:new St(o,s[a])}return i});return new cl(this.table,r,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(e){let r=typeof e=="function"?e(new Fi):e;if(!A(r,U)&&!ta(this.table[Kc],r._.selectedFields))throw new Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new cl(this.table,r,this.session,this.dialect,this.withList,!0)}},cl=class extends ot{constructor(e,r,n,i,s,a,o){super(),this.session=n,this.dialect=i,this.config={table:e,values:r,withList:s,select:a,overridingSystemValue_:o}}static[b]="PgInsert";config;returning(e=this.config.table[j.Symbol.Columns]){return this.config.returningFields=e,this.config.returning=Ht(e),this}onConflictDoNothing(e={}){if(e.target===void 0)this.config.onConflict=v`do nothing`;else{let r="";r=Array.isArray(e.target)?e.target.map(i=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(i))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target));let n=e.where?v` where ${e.where}`:void 0;this.config.onConflict=v`(${v.raw(r)})${n} do nothing`}return this}onConflictDoUpdate(e){if(e.where&&(e.targetWhere||e.setWhere))throw new Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let r=e.where?v` where ${e.where}`:void 0,n=e.targetWhere?v` where ${e.targetWhere}`:void 0,i=e.setWhere?v` where ${e.setWhere}`:void 0,s=this.dialect.buildUpdateSet(this.config.table,Yc(this.config.table,e.set)),a="";return a=Array.isArray(e.target)?e.target.map(o=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(o))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(e.target)),this.config.onConflict=v`(${v.raw(a)})${n} do update set ${s}${r}${i}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ll=class extends ot{constructor(e,r,n){super(),this.session=r,this.dialect=n,this.config={view:e}}static[b]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw new Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,e,!0))}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(e,this.authToken))};var ya=class{constructor(e,r,n,i){this.table=e,this.session=r,this.dialect=n,this.withList=i}static[b]="PgUpdateBuilder";authToken;setToken(e){return this.authToken=e,this}set(e){return new th(this.table,Yc(this.table,e),this.session,this.dialect,this.withList).setToken(this.authToken)}},th=class extends ot{constructor(e,r,n,i,s){super(),this.session=n,this.dialect=i,this.config={set:r,table:e,withList:s,joins:[]},this.tableName=Nr(e),this.joinsNotNullableMap=typeof this.tableName=="string"?{[this.tableName]:!0}:{}}static[b]="PgUpdate";config;tableName;joinsNotNullableMap;from(e){let r=e,n=Nr(r);return typeof n=="string"&&(this.joinsNotNullableMap[n]=!0),this.config.from=r,this}getTableLikeFields(e){return A(e,Ze)?e[j.Symbol.Columns]:A(e,qe)?e._.selectedFields:e[ve].selectedFields}createJoin(e){return(r,n)=>{let i=Nr(r);if(typeof i=="string"&&this.config.joins.some(s=>s.alias===i))throw new Error(`Alias "${i}" is already used in this query`);if(typeof n=="function"){let s=this.config.from&&!A(this.config.from,U)?this.getTableLikeFields(this.config.from):void 0;n=n(new Proxy(this.config.table[j.Symbol.Columns],new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),s&&new Proxy(s,new Ae({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:n,table:r,joinType:e,alias:i}),typeof i=="string")switch(e){case"left":{this.joinsNotNullableMap[i]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!0;break}case"inner":{this.joinsNotNullableMap[i]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([s])=>[s,!1])),this.joinsNotNullableMap[i]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(e){return this.config.where=e,this}returning(e){if(!e&&(e=Object.assign({},this.config.table[j.Symbol.Columns]),this.config.from)){let r=Nr(this.config.from);if(typeof r=="string"&&this.config.from&&!A(this.config.from,U)){let n=this.getTableLikeFields(this.config.from);e[r]=n}for(let n of this.config.joins){let i=Nr(n.table);if(typeof i=="string"&&!A(n.table,U)){let s=this.getTableLikeFields(n.table);e[i]=s}}}return this.config.returningFields=e,this.config.returning=Ht(e),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:e,...r}=this.dialect.sqlToQuery(this.getSQL());return r}_prepare(e){let r=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,e,!0);return r.joinsNotNullableMap=this.joinsNotNullableMap,r}prepare(e){return this._prepare(e)}authToken;setToken(e){return this.authToken=e,this}execute=e=>this._prepare().execute(e,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new Ae({alias:Tt(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}};var ul=class t extends U{constructor(e){super(t.buildEmbeddedCount(e.source,e.filters).queryChunks),this.params=e,this.mapWith(Number),this.session=e.session,this.sql=t.buildCount(e.source,e.filters)}sql;token;static[b]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(e,r){return v`(select count(*) from ${e}${v.raw(" where ").if(r)}${r})`}static buildCount(e,r){return v`select count(*) as count from ${e}${v.raw(" where ").if(r)}${r};`}setToken(e){return this.token=e,this}then(e,r){return Promise.resolve(this.session.count(this.sql,this.token)).then(e,r)}catch(e){return this.then(void 0,e)}finally(e){return this.then(r=>(e?.(),r),r=>{throw e?.(),r})}};var pl=class{constructor(e,r,n,i,s,a,o){this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o}static[b]="PgRelationalQueryBuilder";findMany(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e||{},"many")}findFirst(e){return new dl(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,e?{...e,limit:1}:{limit:1},"first")}},dl=class extends ot{constructor(e,r,n,i,s,a,o,u,l){super(),this.fullSchema=e,this.schema=r,this.tableNamesMap=n,this.table=i,this.tableConfig=s,this.dialect=a,this.session=o,this.config=u,this.mode=l}static[b]="PgRelationalQuery";_prepare(e){return ye.startActiveSpan("drizzle.prepareQuery",()=>{let{query:r,builtQuery:n}=this._toSQL();return this.session.prepareQuery(n,void 0,e,!0,(i,s)=>{let a=i.map(o=>sl(this.schema,this.tableConfig,o,r.selection,s));return this.mode==="first"?a[0]:a})})}prepare(e){return this._prepare(e)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let e=this._getQuery(),r=this.dialect.sqlToQuery(e.sql);return{query:e,builtQuery:r}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(e){return this.authToken=e,this}execute(){return ye.startActiveSpan("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}};var fl=class extends ot{constructor(e,r,n,i){super(),this.execute=e,this.sql=r,this.query=n,this.mapBatchResult=i}static[b]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(e,r){return r?this.mapBatchResult(e):e}_prepare(){return this}isResponseInArrayMode(){return!1}};var Mi=class{constructor(e,r,n){if(this.dialect=e,this.session=r,this._=n?{schema:n.schema,fullSchema:n.fullSchema,tableNamesMap:n.tableNamesMap,session:r}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:r},this.query={},this._.schema)for(let[i,s]of Object.entries(this._.schema))this.query[i]=new pl(n.fullSchema,this._.schema,this._.tableNamesMap,n.fullSchema[i],s,e,r)}static[b]="PgDatabase";query;$with=(e,r)=>{let n=this;return{as:s=>(typeof s=="function"&&(s=s(new Fi(n.dialect))),new Proxy(new ki(s.getSQL(),r??("getSelectedFields"in s?s.getSelectedFields()??{}:{}),e,!0),new Ae({alias:e,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(e,r){return new ul({source:e,filters:r,session:this.session})}with(...e){let r=this;function n(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e})}function i(l){return new ct({fields:l??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:!0})}function s(l,c){return new ct({fields:c??void 0,session:r.session,dialect:r.dialect,withList:e,distinct:{on:l}})}function a(l){return new ya(l,r.session,r.dialect,e)}function o(l){return new ga(l,r.session,r.dialect,e)}function u(l){return new da(l,r.session,r.dialect,e)}return{select:n,selectDistinct:i,selectDistinctOn:s,update:a,insert:o,delete:u}}select(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect})}selectDistinct(e){return new ct({fields:e??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(e,r){return new ct({fields:r??void 0,session:this.session,dialect:this.dialect,distinct:{on:e}})}update(e){return new ya(e,this.session,this.dialect)}insert(e){return new ga(e,this.session,this.dialect)}delete(e){return new da(e,this.session,this.dialect)}refreshMaterializedView(e){return new ll(e,this.session,this.dialect)}authToken;execute(e){let r=typeof e=="string"?v.raw(e):e.getSQL(),n=this.dialect.sqlToQuery(r),i=this.session.prepareQuery(n,void 0,void 0,!1);return new fl(()=>i.execute(void 0,this.authToken),r,n,s=>i.mapResult(s,!0))}transaction(e,r){return this.session.transaction(e,r)}};var ml=class{constructor(e){this.query=e}authToken;getQuery(){return this.query}mapResult(e,r){return e}setToken(e){return this.authToken=e,this}static[b]="PgPreparedQuery";joinsNotNullableMap},hl=class{constructor(e){this.dialect=e}static[b]="PgSession";execute(e,r){return ye.startActiveSpan("drizzle.operation",()=>ye.startActiveSpan("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1)).setToken(r).execute(void 0,r))}all(e){return this.prepareQuery(this.dialect.sqlToQuery(e),void 0,void 0,!1).all()}async count(e,r){let n=await this.execute(e,r);return Number(n[0].count)}},gl=class extends Mi{constructor(e,r,n,i=0){super(e,r,n),this.schema=n,this.nestedIndex=i}static[b]="PgTransaction";rollback(){throw new el}getTransactionConfigSQL(e){let r=[];return e.isolationLevel&&r.push(`isolation level ${e.isolationLevel}`),e.accessMode&&r.push(e.accessMode),typeof e.deferrable=="boolean"&&r.push(e.deferrable?"deferrable":"not deferrable"),v.raw(r.join(" "))}setTransaction(e){return this.session.execute(v`set transaction ${this.getTransactionConfigSQL(e)}`)}};var rh=class{static[b]="ConsoleLogWriter";write(e){console.log(e)}},yl=class{static[b]="DefaultLogger";writer;constructor(e){this.writer=e?.writer??new rh}logQuery(e,r){let n=r.map(s=>{try{return JSON.stringify(s)}catch{return String(s)}}),i=n.length?` -- params: [${n.join(", ")}]`:"";this.writer.write(`Query: ${e}${i}`)}},vl=class{static[b]="NoopLogger";logQuery(){}};var ce;(function(t){t.assertEqual=i=>i;function e(i){}t.assertIs=e;function r(i){throw new Error}t.assertNever=r,t.arrayToEnum=i=>{let s={};for(let a of i)s[a]=a;return s},t.getValidEnumValues=i=>{let s=t.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),a={};for(let o of s)a[o]=i[o];return t.objectValues(a)},t.objectValues=i=>t.objectKeys(i).map(function(s){return i[s]}),t.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{let s=[];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&s.push(a);return s},t.find=(i,s)=>{for(let a of i)if(s(a))return a},t.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&isFinite(i)&&Math.floor(i)===i;function n(i,s=" | "){return i.map(a=>typeof a=="string"?`'${a}'`:a).join(s)}t.joinValues=n,t.jsonStringifyReplacer=(i,s)=>typeof s=="bigint"?s.toString():s})(ce||(ce={}));var ih;(function(t){t.mergeShapes=(e,r)=>({...e,...r})})(ih||(ih={}));var B=ce.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Mr=t=>{switch(typeof t){case"undefined":return B.undefined;case"string":return B.string;case"number":return isNaN(t)?B.nan:B.number;case"boolean":return B.boolean;case"function":return B.function;case"bigint":return B.bigint;case"symbol":return B.symbol;case"object":return Array.isArray(t)?B.array:t===null?B.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?B.promise:typeof Map<"u"&&t instanceof Map?B.map:typeof Set<"u"&&t instanceof Set?B.set:typeof Date<"u"&&t instanceof Date?B.date:B.object;default:return B.unknown}},O=ce.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),pF=t=>JSON.stringify(t,null,2).replace(/"([^"]+)":/g,"$1:"),Rt=class t extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=n=>{this.issues=[...this.issues,n]},this.addIssues=(n=[])=>{this.issues=[...this.issues,...n]};let r=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,r):this.__proto__=r,this.name="ZodError",this.issues=e}format(e){let r=e||function(s){return s.message},n={_errors:[]},i=s=>{for(let a of s.issues)if(a.code==="invalid_union")a.unionErrors.map(i);else if(a.code==="invalid_return_type")i(a.returnTypeError);else if(a.code==="invalid_arguments")i(a.argumentsError);else if(a.path.length===0)n._errors.push(r(a));else{let o=n,u=0;for(;u<a.path.length;){let l=a.path[u];u===a.path.length-1?(o[l]=o[l]||{_errors:[]},o[l]._errors.push(r(a))):o[l]=o[l]||{_errors:[]},o=o[l],u++}}};return i(this),n}static assert(e){if(!(e instanceof t))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ce.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=r=>r.message){let r={},n=[];for(let i of this.issues)i.path.length>0?(r[i.path[0]]=r[i.path[0]]||[],r[i.path[0]].push(e(i))):n.push(e(i));return{formErrors:n,fieldErrors:r}}get formErrors(){return this.flatten()}};Rt.create=t=>new Rt(t);var ji=(t,e)=>{let r;switch(t.code){case O.invalid_type:t.received===B.undefined?r="Required":r=`Expected ${t.expected}, received ${t.received}`;break;case O.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(t.expected,ce.jsonStringifyReplacer)}`;break;case O.unrecognized_keys:r=`Unrecognized key(s) in object: ${ce.joinValues(t.keys,", ")}`;break;case O.invalid_union:r="Invalid input";break;case O.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${ce.joinValues(t.options)}`;break;case O.invalid_enum_value:r=`Invalid enum value. Expected ${ce.joinValues(t.options)}, received '${t.received}'`;break;case O.invalid_arguments:r="Invalid function arguments";break;case O.invalid_return_type:r="Invalid function return type";break;case O.invalid_date:r="Invalid date";break;case O.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(r=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(r=`${r} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?r=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?r=`Invalid input: must end with "${t.validation.endsWith}"`:ce.assertNever(t.validation):t.validation!=="regex"?r=`Invalid ${t.validation}`:r="Invalid";break;case O.too_small:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:r="Invalid input";break;case O.too_big:t.type==="array"?r=`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?r=`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?r=`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?r=`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?r=`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:r="Invalid input";break;case O.custom:r="Invalid input";break;case O.invalid_intersection_types:r="Intersection results could not be merged";break;case O.not_multiple_of:r=`Number must be a multiple of ${t.multipleOf}`;break;case O.not_finite:r="Number must be finite";break;default:r=e.defaultError,ce.assertNever(t)}return{message:r}},u_=ji;function dF(t){u_=t}function xl(){return u_}var bl=t=>{let{data:e,path:r,errorMaps:n,issueData:i}=t,s=[...r,...i.path||[]],a={...i,path:s};if(i.message!==void 0)return{...i,path:s,message:i.message};let o="",u=n.filter(l=>!!l).slice().reverse();for(let l of u)o=l(a,{data:e,defaultError:o}).message;return{...i,path:s,message:o}},fF=[];function L(t,e){let r=xl(),n=bl({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,r,r===ji?void 0:ji].filter(i=>!!i)});t.common.issues.push(n)}var lt=class t{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,r){let n=[];for(let i of r){if(i.status==="aborted")return K;i.status==="dirty"&&e.dirty(),n.push(i.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,r){let n=[];for(let i of r){let s=await i.key,a=await i.value;n.push({key:s,value:a})}return t.mergeObjectSync(e,n)}static mergeObjectSync(e,r){let n={};for(let i of r){let{key:s,value:a}=i;if(s.status==="aborted"||a.status==="aborted")return K;s.status==="dirty"&&e.dirty(),a.status==="dirty"&&e.dirty(),s.value!=="__proto__"&&(typeof a.value<"u"||i.alwaysSet)&&(n[s.value]=a.value)}return{status:e.value,value:n}}},K=Object.freeze({status:"aborted"}),Li=t=>({status:"dirty",value:t}),ht=t=>({status:"valid",value:t}),sh=t=>t.status==="aborted",ah=t=>t.status==="dirty",Fn=t=>t.status==="valid",ba=t=>typeof Promise<"u"&&t instanceof Promise;function wl(t,e,r,n){if(r==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?n:r==="a"?n.call(t):n?n.value:e.get(t)}function p_(t,e,r,n,i){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?i.call(t,r):i?i.value=r:e.set(t,r),r}var z;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e?.message})(z||(z={}));var va,xa,Vt=class{constructor(e,r,n,i){this._cachedPath=[],this.parent=e,this.data=r,this._path=n,this._key=i}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},o_=(t,e)=>{if(Fn(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let r=new Rt(t.common.issues);return this._error=r,this._error}}};function te(t){if(!t)return{};let{errorMap:e,invalid_type_error:r,required_error:n,description:i}=t;if(e&&(r||n))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(a,o)=>{var u,l;let{message:c}=t;return a.code==="invalid_enum_value"?{message:c??o.defaultError}:typeof o.data>"u"?{message:(u=c??n)!==null&&u!==void 0?u:o.defaultError}:a.code!=="invalid_type"?{message:o.defaultError}:{message:(l=c??r)!==null&&l!==void 0?l:o.defaultError}},description:i}}var re=class{get description(){return this._def.description}_getType(e){return Mr(e.data)}_getOrReturnCtx(e,r){return r||{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new lt,ctx:{common:e.parent.common,data:e.data,parsedType:Mr(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let r=this._parse(e);if(ba(r))throw new Error("Synchronous parse encountered promise.");return r}_parseAsync(e){let r=this._parse(e);return Promise.resolve(r)}parse(e,r){let n=this.safeParse(e,r);if(n.success)return n.data;throw n.error}safeParse(e,r){var n;let i={common:{issues:[],async:(n=r?.async)!==null&&n!==void 0?n:!1,contextualErrorMap:r?.errorMap},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},s=this._parseSync({data:e,path:i.path,parent:i});return o_(i,s)}"~validate"(e){var r,n;let i={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)};if(!this["~standard"].async)try{let s=this._parseSync({data:e,path:[],parent:i});return Fn(s)?{value:s.value}:{issues:i.common.issues}}catch(s){!((n=(r=s?.message)===null||r===void 0?void 0:r.toLowerCase())===null||n===void 0)&&n.includes("encountered")&&(this["~standard"].async=!0),i.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:i}).then(s=>Fn(s)?{value:s.value}:{issues:i.common.issues})}async parseAsync(e,r){let n=await this.safeParseAsync(e,r);if(n.success)return n.data;throw n.error}async safeParseAsync(e,r){let n={common:{issues:[],contextualErrorMap:r?.errorMap,async:!0},path:r?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Mr(e)},i=this._parse({data:e,path:n.path,parent:n}),s=await(ba(i)?i:Promise.resolve(i));return o_(n,s)}refine(e,r){let n=i=>typeof r=="string"||typeof r>"u"?{message:r}:typeof r=="function"?r(i):r;return this._refinement((i,s)=>{let a=e(i),o=()=>s.addIssue({code:O.custom,...n(i)});return typeof Promise<"u"&&a instanceof Promise?a.then(u=>u?!0:(o(),!1)):a?!0:(o(),!1)})}refinement(e,r){return this._refinement((n,i)=>e(n)?!0:(i.addIssue(typeof r=="function"?r(n,i):r),!1))}_refinement(e){return new Dt({schema:this,typeName:V.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:r=>this["~validate"](r)}}optional(){return Qt.create(this,this._def)}nullable(){return hr.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Lr.create(this)}promise(){return tn.create(this,this._def)}or(e){return $n.create([this,e],this._def)}and(e){return zn.create(this,e,this._def)}transform(e){return new Dt({...te(this._def),schema:this,typeName:V.ZodEffects,effect:{type:"transform",transform:e}})}default(e){let r=typeof e=="function"?e:()=>e;return new Wn({...te(this._def),innerType:this,defaultValue:r,typeName:V.ZodDefault})}brand(){return new wa({typeName:V.ZodBranded,type:this,...te(this._def)})}catch(e){let r=typeof e=="function"?e:()=>e;return new Kn({...te(this._def),innerType:this,catchValue:r,typeName:V.ZodCatch})}describe(e){let r=this.constructor;return new r({...this._def,description:e})}pipe(e){return Ta.create(this,e)}readonly(){return Yn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},mF=/^c[^\s-]{8,}$/i,hF=/^[0-9a-z]+$/,gF=/^[0-9A-HJKMNP-TV-Z]{26}$/i,yF=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,vF=/^[a-z0-9_-]{21}$/i,xF=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,bF=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,wF=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,TF="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",nh,SF=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,_F=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,PF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,CF=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,EF=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,AF=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,d_="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",IF=new RegExp(`^${d_}$`);function f_(t){let e="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision==null&&(e=`${e}(\\.\\d+)?`),e}function kF(t){return new RegExp(`^${f_(t)}$`)}function m_(t){let e=`${d_}T${f_(t)}`,r=[];return r.push(t.local?"Z?":"Z"),t.offset&&r.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${r.join("|")})`,new RegExp(`^${e}$`)}function OF(t,e){return!!((e==="v4"||!e)&&SF.test(t)||(e==="v6"||!e)&&PF.test(t))}function NF(t,e){if(!xF.test(t))return!1;try{let[r]=t.split("."),n=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),i=JSON.parse(atob(n));return!(typeof i!="object"||i===null||!i.typ||!i.alg||e&&i.alg!==e)}catch{return!1}}function RF(t,e){return!!((e==="v4"||!e)&&_F.test(t)||(e==="v6"||!e)&&CF.test(t))}var Jr=class t extends re{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==B.string){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.string,received:s.parsedType}),K}let n=new lt,i;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="max")e.data.length>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),n.dirty());else if(s.kind==="length"){let a=e.data.length>s.value,o=e.data.length<s.value;(a||o)&&(i=this._getOrReturnCtx(e,i),a?L(i,{code:O.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&L(i,{code:O.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),n.dirty())}else if(s.kind==="email")wF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"email",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="emoji")nh||(nh=new RegExp(TF,"u")),nh.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"emoji",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="uuid")yF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"uuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="nanoid")vF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"nanoid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid")mF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="cuid2")hF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cuid2",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="ulid")gF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ulid",code:O.invalid_string,message:s.message}),n.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),L(i,{validation:"url",code:O.invalid_string,message:s.message}),n.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"regex",code:O.invalid_string,message:s.message}),n.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),n.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{startsWith:s.value},message:s.message}),n.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:{endsWith:s.value},message:s.message}),n.dirty()):s.kind==="datetime"?m_(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"datetime",message:s.message}),n.dirty()):s.kind==="date"?IF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"date",message:s.message}),n.dirty()):s.kind==="time"?kF(s).test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{code:O.invalid_string,validation:"time",message:s.message}),n.dirty()):s.kind==="duration"?bF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"duration",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="ip"?OF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"ip",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="jwt"?NF(e.data,s.alg)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"jwt",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="cidr"?RF(e.data,s.version)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"cidr",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64"?EF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64",code:O.invalid_string,message:s.message}),n.dirty()):s.kind==="base64url"?AF.test(e.data)||(i=this._getOrReturnCtx(e,i),L(i,{validation:"base64url",code:O.invalid_string,message:s.message}),n.dirty()):ce.assertNever(s);return{status:n.value,value:e.data}}_regex(e,r,n){return this.refinement(i=>e.test(i),{validation:r,code:O.invalid_string,...z.errToObj(n)})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...z.errToObj(e)})}url(e){return this._addCheck({kind:"url",...z.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...z.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...z.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...z.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...z.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...z.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...z.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...z.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...z.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...z.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...z.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...z.errToObj(e)})}datetime(e){var r,n;return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof e?.precision>"u"?null:e?.precision,offset:(r=e?.offset)!==null&&r!==void 0?r:!1,local:(n=e?.local)!==null&&n!==void 0?n:!1,...z.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof e?.precision>"u"?null:e?.precision,...z.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...z.errToObj(e)})}regex(e,r){return this._addCheck({kind:"regex",regex:e,...z.errToObj(r)})}includes(e,r){return this._addCheck({kind:"includes",value:e,position:r?.position,...z.errToObj(r?.message)})}startsWith(e,r){return this._addCheck({kind:"startsWith",value:e,...z.errToObj(r)})}endsWith(e,r){return this._addCheck({kind:"endsWith",value:e,...z.errToObj(r)})}min(e,r){return this._addCheck({kind:"min",value:e,...z.errToObj(r)})}max(e,r){return this._addCheck({kind:"max",value:e,...z.errToObj(r)})}length(e,r){return this._addCheck({kind:"length",value:e,...z.errToObj(r)})}nonempty(e){return this.min(1,z.errToObj(e))}trim(){return new t({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new t({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxLength(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};Jr.create=t=>{var e;return new Jr({checks:[],typeName:V.ZodString,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};function DF(t,e){let r=(t.toString().split(".")[1]||"").length,n=(e.toString().split(".")[1]||"").length,i=r>n?r:n,s=parseInt(t.toFixed(i).replace(".","")),a=parseInt(e.toFixed(i).replace(".",""));return s%a/Math.pow(10,i)}var Mn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==B.number){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.number,received:s.parsedType}),K}let n,i=new lt;for(let s of this._def.checks)s.kind==="int"?ce.isInteger(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.invalid_type,expected:"integer",received:"float",message:s.message}),i.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),i.dirty()):s.kind==="multipleOf"?DF(e.data,s.value)!==0&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_finite,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:z.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}finite(e){return this._addCheck({kind:"finite",message:z.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:z.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:z.toString(e)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&ce.isInteger(e.value))}get isFinite(){let e=null,r=null;for(let n of this._def.checks){if(n.kind==="finite"||n.kind==="int"||n.kind==="multipleOf")return!0;n.kind==="min"?(r===null||n.value>r)&&(r=n.value):n.kind==="max"&&(e===null||n.value<e)&&(e=n.value)}return Number.isFinite(r)&&Number.isFinite(e)}};Mn.create=t=>new Mn({checks:[],typeName:V.ZodNumber,coerce:t?.coerce||!1,...te(t)});var qn=class t extends re{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==B.bigint)return this._getInvalidInput(e);let n,i=new lt;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),i.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(n=this._getOrReturnCtx(e,n),L(n,{code:O.not_multiple_of,multipleOf:s.value,message:s.message}),i.dirty()):ce.assertNever(s);return{status:i.value,value:e.data}}_getInvalidInput(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.bigint,received:r.parsedType}),K}gte(e,r){return this.setLimit("min",e,!0,z.toString(r))}gt(e,r){return this.setLimit("min",e,!1,z.toString(r))}lte(e,r){return this.setLimit("max",e,!0,z.toString(r))}lt(e,r){return this.setLimit("max",e,!1,z.toString(r))}setLimit(e,r,n,i){return new t({...this._def,checks:[...this._def.checks,{kind:e,value:r,inclusive:n,message:z.toString(i)}]})}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:z.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:z.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:z.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:z.toString(e)})}multipleOf(e,r){return this._addCheck({kind:"multipleOf",value:e,message:z.toString(r)})}get minValue(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e}get maxValue(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e}};qn.create=t=>{var e;return new qn({checks:[],typeName:V.ZodBigInt,coerce:(e=t?.coerce)!==null&&e!==void 0?e:!1,...te(t)})};var Ln=class extends re{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==B.boolean){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.boolean,received:n.parsedType}),K}return ht(e.data)}};Ln.create=t=>new Ln({typeName:V.ZodBoolean,coerce:t?.coerce||!1,...te(t)});var jn=class t extends re{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==B.date){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_type,expected:B.date,received:s.parsedType}),K}if(isNaN(e.data.getTime())){let s=this._getOrReturnCtx(e);return L(s,{code:O.invalid_date}),K}let n=new lt,i;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),n.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(i=this._getOrReturnCtx(e,i),L(i,{code:O.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),n.dirty()):ce.assertNever(s);return{status:n.value,value:new Date(e.data.getTime())}}_addCheck(e){return new t({...this._def,checks:[...this._def.checks,e]})}min(e,r){return this._addCheck({kind:"min",value:e.getTime(),message:z.toString(r)})}max(e,r){return this._addCheck({kind:"max",value:e.getTime(),message:z.toString(r)})}get minDate(){let e=null;for(let r of this._def.checks)r.kind==="min"&&(e===null||r.value>e)&&(e=r.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(let r of this._def.checks)r.kind==="max"&&(e===null||r.value<e)&&(e=r.value);return e!=null?new Date(e):null}};jn.create=t=>new jn({checks:[],coerce:t?.coerce||!1,typeName:V.ZodDate,...te(t)});var Bi=class extends re{_parse(e){if(this._getType(e)!==B.symbol){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.symbol,received:n.parsedType}),K}return ht(e.data)}};Bi.create=t=>new Bi({typeName:V.ZodSymbol,...te(t)});var Bn=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.undefined,received:n.parsedType}),K}return ht(e.data)}};Bn.create=t=>new Bn({typeName:V.ZodUndefined,...te(t)});var Un=class extends re{_parse(e){if(this._getType(e)!==B.null){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.null,received:n.parsedType}),K}return ht(e.data)}};Un.create=t=>new Un({typeName:V.ZodNull,...te(t)});var en=class extends re{constructor(){super(...arguments),this._any=!0}_parse(e){return ht(e.data)}};en.create=t=>new en({typeName:V.ZodAny,...te(t)});var qr=class extends re{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ht(e.data)}};qr.create=t=>new qr({typeName:V.ZodUnknown,...te(t)});var nr=class extends re{_parse(e){let r=this._getOrReturnCtx(e);return L(r,{code:O.invalid_type,expected:B.never,received:r.parsedType}),K}};nr.create=t=>new nr({typeName:V.ZodNever,...te(t)});var Ui=class extends re{_parse(e){if(this._getType(e)!==B.undefined){let n=this._getOrReturnCtx(e);return L(n,{code:O.invalid_type,expected:B.void,received:n.parsedType}),K}return ht(e.data)}};Ui.create=t=>new Ui({typeName:V.ZodVoid,...te(t)});var Lr=class t extends re{_parse(e){let{ctx:r,status:n}=this._processInputParams(e),i=this._def;if(r.parsedType!==B.array)return L(r,{code:O.invalid_type,expected:B.array,received:r.parsedType}),K;if(i.exactLength!==null){let a=r.data.length>i.exactLenpm warn config production Use `--omit=dev` instead.
> rest-express@1.0.0 start
> node dist/index.cjs
/app/dist/index.cjs:74